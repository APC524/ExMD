# Extensible MD (ExMD)
ExMD is a framework for simulating molecular dynamics. Particles are simulated under a user-defined number of forces in a variable sized domain with multiple possibilities for boundary behavior. In addition, it provides code to create visualizations of the particles.

## Table of Contents
1. [Getting Started](#getting_started)
    1. [Requirements](#requirements)
    2. [Building the Project](#build_project)
2. [Examples] (#examples)
3. [Usage] (#usage)
    3. [Input] (#input)
    4. [Simulation] (#simulation)
    5. [Visualization] (#visualize)
6. [Testing] (#testing)
    1. [Unit tests] (#unittest)
    2. [Style check] (#style)
7. [Documentation](#documentation)

## Getting Started <a name="getting_started"></a>

### Requirements <a name="requirements"></a>
The following open-source programs must be installed in order to work with this project:
* g++       (Version 5.3 or newer)
* python    (Version 2.7)
* CMake     (Version 2.8 or newer): https://cmake.org/
* Paraview  (Version 5.1.2 or newer): http://www.paraview.org/
* Doxygen   (Version 1.8.3 or newer): http://www.stack.nl/~dimitri/doxygen/

Paraview's own version of Python (pvpython) is required, so make sure that its path is set correctly. For more information on how to set the path, check the following wiki-page: https://github.com/APC524/ExMD/wiki/Setting-the-path-for-pvpython

## Building the Project <a name="build_project"></a>
From the project root folder, create a new directory called "build":

    mkdir build/

change directory to the "build" folder, and build the project using cmake:

    cd build/
    cmake ..

this will generate the necessary Makefile to compile all the source code. Compiling the source code is simply done by typing "make" in the "build" folder:

    make

### Custom Targets
There are a number of custom targets that become available, depending on which flags are set when building the project with cmake. The list below shows all the available targets, each of which will be discussed in more detail in the following sections.

* **cmake ..**
    * make vtk [Used for generating visualization files after simulation]
    * make doc [Used for generating project documentation]
* **cmake -Dexample=ON ..**
    * make example [Used for generating project examples]
* **cmake -Dtest=ON ..**
    * make test [Used for running unit tests]
* **cmake -Dstyle=ON ..**
    * make test [Used for running unit tests and style check]

**Ex.:** running `cmake ..` from the "build" folder makes the custom targets **'vtk'** and **'doc'** available. Running `cmake -Dexample=ON ..` makes **'vtk'**, **'doc'** and **'example'** available, etc.


## Examples <a name="examples"></a>
The project comes with a couple of examples that show some of the features that have been implemented. These examples become available when the project is build with the '-Dexample=ON' flag. From the "build" folder type:

    cmake -Dexample=ON ..

Then, the examples can be generated by typing:

    make example

Three examples are generated:
* Example 1: Elastic collisions
* Example 2: Gravity
* Example 3: Flocking

The visualization files are automatically generated. For more information and instructions on how to visualize the examples, please take a look at the associated wiki-page: https://github.com/APC524/ExMD/wiki/Visualizing-the-Examples

## Usage <a name="usage"></a>
After building the project with 'cmake' and compiling it by running 'make', an executable called 'exmd' can be found in "build/bin/". This executable allows the user to run his own simulations by providing a file that defines the particles, and editing the file 'params.json' in the "input" folder.

### Input <a name="input"></a>
The program requires two input files to run. Both are located in the "input" folder. The first is a 'csv' file that specifies the attributes of the particles. The second is a parameter file that sets the program parameters.

The 'csv' file has the following header:

    x,y,z,vx,vy,vz,mass,radius

which means that it specifies the initial position, velocity, mass and radius for the particles. The file is given as an argument to the executable 'exmd', which means that the user is free to provide his own 'csv' file, as long as it is put in the "input" folder and has the same header. From "build/bin":

    Usage: ./exmd <name_of_input_file>

**Ex.:** With a file called input.csv, execution becomes `./exmd input`.

The second file is called 'params.json' and is required by the program. The file looks as follows:

    {
	    "simulation" : 
	    {
		    "nparticles" : 149,
		    "nsteps" : 350,
            "dt" : 0.01
	    },
	    "forces" : 
	    {
		    "drag" : 
		    {
			    "include" : false,
			    "gamma" : 0.0
		    },
		    "flocking" : 
		    {
			    "include" : false,
			    "beta" : 0.0
		    },
		    "gravity" : 
		    {
			    "include" : false,
			    "G" : 0.0
  		    }
	    },
	    "boundary" : 
	    {
            "type" : "none",
            "x_lim" : [ -100, 100 ],
            "y_lim" : [ -100, 100 ],
            "z_lim" : [ -100, 100 ]
        }
    }

It allows the user to specify the simulation parameters, which the program will then use during execution.

NOTE:
* The number of particles (nparticles) must agree with the number of particles specified in the 'csv' file.
* Forces can be included by changing "include" from **'false'** to **'true'**
* The program currently allows for two types of boundaries: **'none'** and **'reflecting'**

### Simulation <a name="simulation"></a>
Running the 'exmd' executable with the appropriate inputs will have the program run through the simulation and output 'csv' files that can be found in "folder/output/csv". These files provide the positions, velocities and radius for every particle at each timestep, which is used in the post-processing to visualize the simulation.

### Visualization <a name="visualize"></a>
The last step is to visualize the data, which can be done by simply maneuvering to the "build" folder and typing:

    make vtk

This will convert all the 'csv' files from the simulation to 'vtk' files that can be used to visualize in Paraview. The output 'vtk' files can be found in "build/output/vtk".

After all the 'csv' files have been converted to 'vtk' files, the user can then open Paraview, navigate to "build/output/vtk" and open 'exmd...vtp' which will include all the timesteps of the simulation. If the boundary has been set to 'reflecting', then 'exmd_frame.vtp' can also be opened to visualize the boundary. See the wiki-page for visualizing the examples for more details: https://github.com/APC524/ExMD/wiki/Visualizing-the-Examples

## Testing <a name="testing"></a>
The project includes several features for testing the source code. It has two unit testing suits, for C++ and Python, and also a style checker for C++. The C++ unit testing is done using Google Testing, Python unit tests are done using PyUnit, and style checking is according to Google C++ style.

These testing features can be activated by building the project with the appropriate flags. From the "build" folder, type:
* **Unit tests:**

    cmake -Dtest=ON ..

* **Unit tests + Style check**

    cmake -Dstyle=ON ..

In both cases, the target **'test'** will become available, which means that testing can be performed by first running 'make' and then 'make test' in the build folder:

    make
    make test

Running 'make test' generates output that looks something like:
* **Unit tests:** <a name="unittest"></a>

        Running tests...
        Test project /Users/brosten/Desktop/temp/ExMD/build
            Start 1: CppUnitTests
        1/2 Test #1: CppUnitTests .....................   Passed    0.02 sec
            Start 2: PyUnitTests
        2/2 Test #2: PyUnitTests ......................   Passed    0.62 sec
        
        100% tests passed, 0 tests failed out of 2
        
        Total Test time (real) =   0.65 sec

* **Unit tests + Style check** <a name="style"></a>

        Running tests...
        Test project /Users/brosten/Desktop/temp/ExMD/build
            Start 1: CppUnitTests
        1/3 Test #1: CppUnitTests .....................   Passed    0.02 sec
            Start 2: PyUnitTests
        2/3 Test #2: PyUnitTests ......................   Passed    0.50 sec
            Start 3: GoogleStyle
        3/3 Test #3: GoogleStyle ......................   Passed    1.14 sec
        
        100% tests passed, 0 tests failed out of 3
        
        Total Test time (real) =   1.66 sec

Where each of the tests listed here are in fact test suits, which can be inspected further by typing:

    ctest -V -R <name_of_test>

**Ex.:** `ctest -V -R CppUnitTests` will show explicitly all the unit tests within this test suit.

Additionally, if any of the tests suits were to fail; running the above command with the name of the relevant test suit would explicitly show which tests are failing and what must be corrected in order for the test suit to pass.

## Documentation <a name="documentation"></a>
The project is documented automatically using Doxygen. This documentation can be accessed through the custom target **'doc'**. By typing

    make doc

in the "build" folder, the documentation will be generated.

The pdf-version of the documentation can then be created by going to "build/doc/latex" and running `make` from within this folder, assuming that latex is installed. This produces a file named 'refman.pdf', which is the pdf-version of the project documentation.
